function e_hat_n = d_sim(sys, d_n,x0, nl)
    h = size(d_n,1)
    x = zeros(h+1,nx);w = zeros(h,nw);e_hat_n = zeros(h,ne);z =zeros(h,nz);
    x(1,:) = x0; % initial condition
    for k=1:h
        z(k,:) = sys.C2 * x(k,:)' + D21 * d_n(k,:)';
        w(k,:) = dzn(z(k,:));
        x(k+1,:) = A * x(k,:)' + B * d_n(k,:)' + B2 * w(k,:)';
        e_hat_n(k,:)= C * x(k,:)' + D * d_n(k,:)' + D12 * w(k,:)';
    end
end